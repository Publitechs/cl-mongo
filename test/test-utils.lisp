(in-package :cl-mongo-test)

(defun send-doc-in-doc-in-doc (collection)
  (with-mongo-connection (:host "localhost" :port *mongo-default-port* :db "test" )
			 (let ((doc (make-document)))
			   (add-element "string" "hello world generated by test-document" doc)
			   (add-element "number89" 89 doc)
			   (add-element "numberbig" 89988787777887 doc)
			   (add-element "float 89.67" 89.67 doc)
			   (add-element "list-1" (list 1 2 3 4) doc)
			   (add-element "list-2" (list 1 (list "inside" 3 4 "list" ) "the end") doc)
			   (let ((doc2 (make-document)))
			     (add-element "key-1" "doc in doc !!" doc2)
			     (add-element "key-2" 56.89 doc2)
			     (let ((doc3 (make-document)))
			       (add-element "array" (list (list (list "inside a nest!!"))) doc3)
			       (add-element "key56" 56 doc3)
			       (add-element "doc3" doc3 doc2)
			       (add-element "doc2" doc2 doc)
			       (db.insert collection doc ))))))


(defun test-doc-simple (collection)
  (with-mongo-connection (:host "localhost" :port *mongo-default-port* :db "test" )
			 (let ((doc (make-document)))
			   (add-element "string" "hello world generated by test-document" doc)
			   (add-element "1" 1 doc)
			   (add-element "2" 2 doc)
			   (add-element "3" 3 doc)
			   (add-element "4" 40 doc)
			   (add-element "5" 30 doc)
			   (db.insert collection doc ))))

(defun send-test-document ( collection )
  (with-mongo-connection (:host "localhost" :port *mongo-default-port* :db "test" )
			 (let ((doc (make-document)))
			   (add-element "string" "hello world generated by test-document" doc)
			   (add-element "number89" 89 doc)
			   (add-element "numberbig" 89988787777887 doc)
			   (add-element "float 89.67" 89.67 doc)
			   (add-element "list-1" (list 1 2 3 4) doc)
			   (add-element "list-2" (list 1 (list "inside" 3 4 "list" ) "the end") doc)
			   (db.insert collection doc ))))

(defun insert-lots (collection n)
  (with-mongo-connection (:host "localhost" :port *mongo-default-port* :db "test" )
			 (dotimes (i n)
			   (let ((doc (make-document)))
			     (add-element (format  nil "name") "simple" doc)
			     (add-element (format nil "~D" i) i doc)
			     (add-element (format nil "k") (+ 56.00 i) doc)
			     (add-element (format nil "l") (- i 9.00)  doc)
			     (add-element (format nil "index-this") i doc)
			     (add-element (format nil "value-1") (* 78 i) doc)
			     (db.insert collection doc )))))
			


